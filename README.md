# GitHub PR Reaction Scraper

This repository contains a shell script (`fetch_reactions.sh`) designed to collect and score emoji reactions from GitHub Pull Requests. The primary goal is to gather subjective feedback on code reviews, with a special focus on reviews generated by GitHub Copilot.

The script aggregates reactions based on a point system, allowing for quantitative analysis of qualitative feedback.

## Features

-   **Multi-Repository Support**: Scans one or more specified repositories.
-   **Date Range Filtering**: Collects data from Pull Requests created within a defined period.
-   **Comprehensive Comment Collection**: Gathers reactions from three types of comments to ensure complete coverage:
    1.  **Issue Comments**: General comments on the PR.
    2.  **Pull Request Review Comments**: Comments on specific lines of code.
    3.  **Pull Request Reviews**: The summary comment of a review.
-   **Point-Based Scoring**: Assigns a point value to each emoji reaction for easy analysis.
-   **CSV Output**: Outputs the collected data in a simple CSV format (`date,repository,points`).

## Prerequisites

To use this script, you need the following tools installed in your environment (tested on Ubuntu/macOS):

-   [**GitHub CLI (`gh`)**](https://cli.github.com/): For interacting with the GitHub API.
-   [**`jq`**](https://stedolan.github.io/jq/): A command-line JSON processor.

## Setup

1.  **Install Dependencies:**
    -   On macOS (using Homebrew):
        ```bash
        brew install gh jq
        ```
    -   On Ubuntu:
        ```bash
        sudo apt update
        sudo apt install gh jq -y
        ```

2.  **Authenticate with GitHub:**
    Log in to your GitHub account using the GitHub CLI. This will allow the script to access the GitHub API on your behalf.
    ```bash
    gh auth login
    ```

## How to Use

1.  **Configure the Script:**
    Open `fetch_reactions.sh` and modify the following variables in the "è¨­å®š" (Settings) section:
    -   `START_DATE`: The beginning of the collection period (format: `YYYY-MM-DD`).
    -   `END_DATE`: The end of the collection period (format: `YYYY-MM-DD`).
    -   `COPILOT_USER`: The username of the GitHub Copilot bot (default is `github-actions[bot]`).

2.  **Make the Script Executable:**
    ```bash
    chmod +x fetch_reactions.sh
    ```

3.  **Run the Script:**
    Execute the script, passing the target repositories as arguments. The output will be redirected to a CSV file.
    ```bash
    ./fetch_reactions.sh owner/repo1 owner/repo2 > reactions.csv

4.  **Display a Summary in the Terminal (Optional):**
    Use the `-s` flag to display a formatted summary directly in your terminal instead of creating a CSV file.
    ```bash
    ./fetch_reactions.sh -s owner/repo1 owner/repo2
    ```

    This will produce output similar to the following:

    ```
    --- æ—¥åˆ¥ã‚µãƒžãƒªãƒ¼ ---
    æ—¥ä»˜          | ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•° | åˆè¨ˆãƒã‚¤ãƒ³ãƒˆ | å¹³å‡ãƒã‚¤ãƒ³ãƒˆ
    --------------|----------------|--------------|--------------
    2025-06-25    | 2              | 5            | 2.50
    2025-06-26    | 5              | 11           | 2.20

    --- é€±åˆ¥ã‚µãƒžãƒªãƒ¼ ---
    é€±             | ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•° | åˆè¨ˆãƒã‚¤ãƒ³ãƒˆ | å¹³å‡ãƒã‚¤ãƒ³ãƒˆ
    ---------------|----------------|--------------|--------------
    2025-26        | 7              | 16           | 2.29
    ```
    ```

### Emoji Scoring System

The script uses the following point system to score reactions. You can customize these values in the `process_reactions` function within the script.

| Emoji        | Points |
| :----------- | :----: |
| ðŸ‘ `+1`      |   +3   |
| ðŸŽ‰ `hooray`   |   +2   |
| â¤ï¸ `heart`     |   +2   |
| ðŸš€ `rocket`    |   +1   |
| ðŸ˜„ `laugh`    |   +1   |
| ðŸ¤” `confused` |   -1   |
| ðŸ‘Ž `-1`      |   -2   |
| *Other*      |    0   |

## Data Analysis Examples

Once you have the `reactions.csv` file, you can use tools like `awk` to perform quick analyses.

### Daily Aggregation

This command calculates the total points, reaction count, and average points for each day.

```bash
awk -F, 'NR>1 {
    count[$1]++; 
    sum[$1]+=$3;
} 
END {
    print "Date,TotalPoints,ReactionCount,AveragePoints";
    for (date in sum) {
        printf "%s,%d,%d,%.2f\n", date, sum[date], count[date], sum[date]/count[date];
    }
}' reactions.csv | sort
```

### Weekly Aggregation

This command calculates the same metrics on a weekly basis.

```bash
awk -F, 'NR>1 {
    cmd = "date -d " $1 " +%Y-%V"; 
    cmd | getline week; 
    close(cmd); 
    count[week]++; 
    sum[week]+=$3;
} 
END {
    print "Week,TotalPoints,ReactionCount,AveragePoints";
    for (week in sum) {
        printf "%s,%d,%d,%.2f\n", week, sum[week], count[week], sum[week]/count[week];
    }
}' reactions.csv | sort
```

## Customization

### Collecting Reactions from All Users

To collect reactions from all users (not just Copilot), find the `JQ_FILTER` variable in the script and change it as follows:

**From (Copilot only):**
```bash
JQ_FILTER=".[] | select(.user.login == \"$COPILOT_USER\")"
```

**To (All users):**
```bash
JQ_FILTER=".[]"
```

## License

This project is licensed under the MIT License.

